try{var language=chrome.i18n.getUILanguage();if(language.indexOf("es")>-1||language.indexOf("ru")>-1||language.indexOf("de")>-1||language.indexOf("ja")>-1){$(function(){$("body").addClass("wide")})}$(function(){$(".show-"+language.toLowerCase()).removeClass("hidden")})}catch(err){$(function(){$("body").addClass("wide")})}if(localStorage["options.padding"]){document.write('<style type="text/css">');document.write("#pages li a {padding:"+localStorage["options.padding"]+"px; }");document.write("</style>")}var preview=Array;preview["bg"]=localStorage["options.colors.dialbg"];preview["bgover"]=localStorage["options.colors.dialbgover"];preview["bginner"]=localStorage["options.colors.dialbginner"];preview["bginnerover"]=localStorage["options.colors.dialbginnerover"];preview["border"]=localStorage["options.colors.border"];preview["borderover"]=localStorage["options.colors.borderover"];preview["title"]=localStorage["options.colors.title"];preview["titleover"]=localStorage["options.colors.titleover"];preview["titlealign"]=localStorage["options.titleAlign"];preview["titlefontface"]=localStorage["options.fontface"];preview["padding"]=localStorage["options.padding"];preview["corners"]=localStorage["options.dialstyle.corners"];preview["shadow"]=localStorage["options.dialstyle.shadow"];function reloadCss(){$("#pages li a").css("background-color",preview["bg"]);$("#pages li a").css("border-color",preview["border"]);$("#pages li a").css("padding",preview["padding"]);$("#pages li a").css("width",420-(12-preview["padding"]));$("#pages li a").css("border-radius",preview["corners"]+"px");$("#pages li .thumbnail_container").css("border-radius",preview["corners"]+"px "+preview["corners"]+"px 0 0");$("#pages li .thumbnail_container").css("background-color",preview["bginner"]);$("#pages li .title").css("color",preview["title"]);$("#pages li .title").css("text-align",preview["titlealign"]);$("#pages li .title").css("font-family",preview["titlefontface"]+"!important");if(preview["shadow"]&&preview["shadow"]!="none"){$("#pages li").attr("class","link");$("#pages li").addClass("link--shadow").addClass("link--shadow-"+preview["shadow"])}else{$("#pages li").attr("class","link")}$("#pages li a").hover(function(){$("#pages li a").css("background-color",preview["bgover"]);$("#pages li .thumbnail_container").css("background-color",preview["bginnerover"]);$("#pages li a").css("border-color",preview["borderover"]);$("#pages li .title").css("color",preview["titleover"])},function(){$("#pages li a").css("background-color",preview["bg"]);$("#pages li .thumbnail_container").css("background-color",preview["bginner"]);$("#pages li a").css("border-color",preview["border"]);$("#pages li .title").css("color",preview["title"])})}function setPreview(prop,value){preview[prop]=value;reloadCss()}function switchTab(tabhash){$(".tabs li").removeClass("selected");$(".tabs li[rel="+tabhash+"]").addClass("selected");$(".tab").hide();$("#"+tabhash).show();window.location.hash=tabhash;$(".settings_buttons").show();$(".themes-confirm").removeClass("show");$("html").scrollTop();window.scrollTo(0,0)}function showSection(section){window.scroll(0,0);$("#options_navigation li a").removeClass("selected");$("#options_navigation a[rel="+section+"]").addClass("selected");$(".options_tab").hide();$("#tab_"+section).show(0);if(section=="sync"||section=="importexport"){$(".settings_buttons").hide()}else{$(".settings_buttons").show()}}function tabsync(){window.scroll(0,0);$(".options_tab_link").removeClass("selected");$("#sync_indicator").addClass("selected");$(".options_tab").hide();$(".settings_buttons").hide();$("#tab_sync").show(0)}$(function(){$(".options_tab_link").click(function(){showSection($(this).attr("rel"))});$("ul.tabs li").click(function(){switchTab($(this).attr("rel"))});$("#themes .bg").click(function(){setBackground(this)});reloadCss();$("input[name=options-corners]").change(function(){setValue("options.dialstyle.corners",$(this).val());setPreview("corners",$(this).val())});$("input[name=options-dropShadow][value="+getValue("options.dialstyle.shadow")+"]").attr("checked","checked");$("#options-fontface").change(function(){setValue("options.fontface",$(this).val());setPreview("titlefontface",$(this).val())});$("#options-fontsize").change(function(){setValue("options.fontsize",$(this).val())});$("#options-fontstyle").change(function(){setValue("options.fontstyle",$(this).val())});$("#options-colors-dialbg").val(getValue("options.colors.dialbg"));$("#options-colors-dialbg").change(function(){setValue("options.colors.dialbg",$(this).val());setPreview("bg",$(this).val())});$("#options-colors-dialbgover").val(getValue("options.colors.dialbgover"));$("#options-colors-dialbgover").change(function(){setValue("options.colors.dialbgover",$(this).val());setPreview("bgover",$(this).val())});$("#options-colors-dialbginner").val(getValue("options.colors.dialbginner"));$("#options-colors-dialbginner").change(function(){setValue("options.colors.dialbginner",$(this).val());setPreview("bginner",$(this).val())});$("#options-colors-dialbginnerover").val(getValue("options.colors.dialbginnerover"));$("#options-colors-dialbginnerover").change(function(){setValue("options.colors.dialbginnerover",$(this).val());setPreview("bginnerover",$(this).val())});$("#options-colors-border").val(getValue("options.colors.border"));$("#options-colors-border").change(function(){setValue("options.colors.border",$(this).val());setPreview("border",$(this).val())});$("#options-colors-borderover").val(getValue("options.colors.borderover"));$("#options-colors-borderover").change(function(){setValue("options.colors.borderover",$(this).val());setPreview("borderover",$(this).val())});$("#options-colors-title").val(getValue("options.colors.title"));$("#options-colors-title").change(function(){setValue("options.colors.title",$(this).val());setPreview("title",$(this).val())});$("#options-colors-titleover").val(getValue("options.colors.titleover"));$("#options-colors-titleover").change(function(){setValue("options.colors.titleover",$(this).val());setPreview("titleover",$(this).val())});if(getValue("options.corners")>=0){$("#options-corners").val(getValue("options.dialstyle.corners"));$("#options-corners-val").val(getValue("options.dialstyle.corners"))}$("#options-corners").on("input",function(){$("#options-corners-val").val($(this).val());setValue("options.dialstyle.corners",$(this).val());setPreview("corners",$(this).val())});if(getValue("options.padding")>=0){$("#options-padding").val(getValue("options.padding"));$("#options-padding-val").val(getValue("options.padding"))}$("#options-padding").on("input",function(){$("#options-padding-val").val($(this).val());setValue("options.padding",$(this).val());setPreview("padding",$(this).val())});if(getValue("options.sidebar")==1){$("#options-sidebar").attr("checked",true)}if(getValue("options.sidebar.showHistory")==1){$("#options-sidebar-showhistory").attr("checked",true)}if(getValue("options.sidebar.showApps")==1){$("#options-sidebar-showapps").attr("checked",true)}if(getValue("options.sidebar.showBookmarks")==1){$("#options-sidebar-showbookmarks").attr("checked",true)}if(getValue("options.apps.show")==1){$("#options-apps-show").attr("checked",true)}switch(getValue("options.apps.theme")){case"transparent":$("#options-apps-theme-transparent").attr("checked",true);break;case"dark":$("#options-apps-theme-dark").attr("checked",true);break;default:$("#options-apps-theme-light").attr("checked",true)}if(getValue("options.centerThumbnailsVertically")==3){$("#options-centerThumbnailsVertically3").attr("checked",true)}else if(getValue("options.centerThumbnailsVertically")==1){$("#options-centerThumbnailsVertically1").attr("checked","checked")}else if(getValue("options.centerThumbnailsVertically")==2){$("#options-centerThumbnailsVertically2").attr("checked",true)}else if(getValue("options.centerThumbnailsVertically")==0){$("#options-centerThumbnailsVertically0").attr("checked",true)}if(getValue("options.columns")>=0){$("#options-columns").val(getValue("options.columns"));$("#options-columns-val").val(getValue("options.columns"))}$("#options-columns").on("input",function(){$("#options-columns-val").val($(this).val());setValue("options.columns",$(this).val())});if(getValue("options.dialspacing")>=0){$("#options-dialspacing").val(getValue("options.dialspacing"));$("#options-dialspacing-val").val(getValue("options.dialspacing"))}$("#options-dialspacing").on("input",function(){$("#options-dialspacing-val").val($(this).val());setValue("options.dialspacing",$(this).val())});if(getValue("options.thumbnailRatio")>=0){$("#options-thumbnailRatio").val(getValue("options.thumbnailRatio"));$("#options-thumbnailRatio-val").val(getValue("options.thumbnailRatio"))}$("#options-thumbnailRatio").on("input",function(){$("#options-thumbnailRatio-val").val(Math.round($(this).val()*100)/100);setValue("options.thumbnailRatio",Math.round($(this).val()*100)/100)});resetThumbnailRatio=function(){$("#options-thumbnailRatio").val(1);$("#options-thumbnailRatio-val").val(1);setValue("options.thumbnailRatio",1)};if(getValue("options.dialSpace")>=0){$("#options-dialspace").val(getValue("options.dialSpace"));$("#options-dialspace-val").val(getValue("options.dialSpace"))}$("#options-dialspace").on("input",function(){$("#options-dialspace-val").val($(this).val());setValue("options.dialSpace",$(this).val())});if(getValue("options.alwaysNewTab")==1){$("#options-alwaysNewTab").attr("checked",true)}if(getValue("options.showSearch")==1){$("#options-showSearch").attr("checked",true)}if(getValue("options.showContextMenu")==1){$("#options-showContextMenu").attr("checked",true)}if(getValue("options.showVisits")==1){$("#options-showVisits").attr("checked",true)}if(getValue("options.showTitle")==1){$("#options-showTitle").attr("checked",true)}if(getValue("options.showAddButton")==1){$("#options-showAddButton").attr("checked",true)}if(getValue("options.keepActiveGroup")==1){$("#options-keepActiveGroup").attr("checked",true)}if(getValue("options.centerVertically")==1){$("#options-centervertically").attr("checked",true)}if(getValue("options.highlight")==1){$("#options-highlight").attr("checked",true)}if(getValue("options.order")=="visits"){$("#options-order-visits").attr("checked",true)}else{$("#options-order-position").attr("checked",true)}if(getValue("options.thumbnailQuality")=="low"){$("#options-thumbquality-low").attr("checked",true)}else if(getValue("options.thumbnailQuality")=="high"){$("#options-thumbquality-high").attr("checked",true)}else{$("#options-thumbquality-medium").attr("checked",true)}$("#options-columns").change(function(){setValue("options.columns",$(this).val())});$("#options-backgroundPosition").val(getValue("options.backgroundPosition"));$("#options-backgroundSize").val(getValue("options.backgroundSize"));$("#options-repeatbackground").val(getValue("options.repeatbackground"));$("#options-repeatbackground").change(function(){setValue("options.repeatbackground",$(this).val())});if(getValue("options.background")){$("#options-background").val(getValue("options.background"))}if(getValue("options.fontsize")){$("#options-fontsize").val(getValue("options.fontsize"))}if(getValue("options.fontface")){$("#options-fontface").val(getValue("options.fontface"))}if(getValue("options.fontstyle")){$("#options-fontstyle").val(getValue("options.fontstyle"))}if(getValue("options.customCss")){$("#options-custom-css").val(getValue("options.customCss"))}$("#options-custom-css").blur(function(){setValue("options.customCss",$(this).val())});if(getValue("options.columns")){$("#options-columns").val(getValue("options.columns"))}switch(getValue("options.titleAlign")){case"left":$("#options-titleAlign-left").attr("checked",true);break;case"right":$("#options-titleAlign-right").attr("checked",true);break;default:$("#options-titleAlign-center").attr("checked",true)}switch(getValue("options.refreshThumbnails")){case"10":$("#options-refreshThumbnails10").attr("checked",true);break;case"5":$("#options-refreshThumbnails5").attr("checked",true);break;case"2":$("#options-refreshThumbnails2").attr("checked",true);break;default:$("#options-refreshThumbnails0").attr("checked",true)}switch(getValue("options.scrollLayout")){case"0":$("#options-scrollLayout0").attr("checked",true);break;default:$("#options-scrollLayout1").attr("checked",true)}$("#options-backgroundPosition").change(function(){setValue("options.backgroundPosition",$(this).val())});$("#options-backgroundSize").change(function(){setValue("options.backgroundSize",$(this).val())});$("#options-background").change(function(){setValue("options.background",$(this).val());setValue("options.backgroundPattern","")});$("#options-colors-bg").val(getValue("options.colors.bg"));$("#options-colors-bg").change(function(){setValue("options.colors.bg",$(this).val())});function set_view_premium_account(response){$(".hide-premium").hide();$(".show-premium").show();$(".show-unregistered").hide();$(".hide-unregistered").show();$("#sync_indicator").find("img").remove();$("#sync_indicator").prepend('<img src="images/options.sync-indicator.png" /> ');$(".sync-status-username").text(getValue("options.sync.username"));$("#sync_status").html(i18n("sync_ok")+", "+i18n("last_synchronization")+" "+moment.unix(parseInt(response.last_sync)).fromNow());if(null!=response.groups&&response.groups>0){$(".sync-status-groups").text(response.groups+" "+i18n("groups"))}if(null!=response.bookmarks&&response.bookmarks>0){$(".sync-status-bookmarks").text(response.bookmarks+" "+i18n("bookmarks"));$(".sync-status-text").show()}b.get_user_backups(function(response){backups_container=$(".sync-backups");if(response.code>-1){if(response.backups&&response.backups.length>0){backups_container.html("");response.backups.forEach(function(backup){var li=$("<li/>");var a=$("<a/>");var name="";a.attr("href",backup.url);a.attr("target","_blank");name+=moment(backup.created_at).fromNow();if(backup.bookmarks_count>0){name+=", "+backup.bookmarks_count+" "+i18n("bookmarks")}if(backup.groups_count>0){name+=" "+backup.groups_count+" "+i18n("groups")}a.text(name);a.appendTo(li);li.append(a).appendTo(backups_container)})}else{backups_container.html("<li>No backup history to show. Please check later.</li>")}}else{backups_container.html("-")}})}function set_view_free_account(){$(".hide-premium").show();$(".show-premium").hide();$(".hide-unregistered").hide();$(".show-unregistered").show();$("#sync_indicator").find("img").remove();$("#sync_indicator").prepend('<img src="images/options.sync-indicator-false.png" />')}function get_sync_status(){var b=chrome.extension.getBackgroundPage();b.test_sync_account(function(response){if(response.code>-1){set_view_premium_account(response)}else{set_view_free_account()}})}if(!getValue("options.sync.password")&&!getValue("options.sync.password")){set_view_free_account()}else{get_sync_status()}var sync_password=getValue("options.sync.password");var sync_username=getValue("options.sync.username");if(sync_username!=""){$("#options-sync-username").val(sync_username)}if(sync_password!=""){$("#options-sync-password").val(sync_password)}$("#logout").click(function(e){if(confirm(i18n("sign_out_confirm"))){localStorage["options.sync.password"]="";localStorage["options.sync.username"]="";$("#options-sync-password").val("");$("#options-sync-username").val("");set_view_free_account();show_message(i18n("sign_out_done"),true,400)}});function _sync(){var b=chrome.extension.getBackgroundPage();var sync_url=speeddial.storage.sync_url();var sync_new_password=$("#options-sync-password").val();var sync_new_username=$("#options-sync-username").val();if(sync_new_password!=sync_password){sync_password=Base64.encode(sync_new_password)}if(sync_new_username!=sync_username){sync_username=sync_new_username}setValue("options.sync.username",sync_username);setValue("options.sync.password",sync_password);if(sync_username!=""&&sync_password!=""){show_message(i18n("sync_connecting"),true,5e4);$.post(sync_url+"/sync2/test",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password")},function(r){if(r){switch(r.code){case 0:show_message(i18n("sync_preparing"),true,5e4);b.sync_to_server(function(response){if(response.code==1){setTimeout(function(){show_message(i18n("sync_connected"),true,600);get_sync_status()},2e3)}else{show_message(i18n("sync_error_import"),true,2e3)}});break;case 1:speeddial.storage.open();if(localStorage.getItem("options.sync.lastsync")){show_message(i18n("sync_wait"),true,1e5);b.sync(function(){show_message(i18n("sync_complete"),true,600);get_sync_status()})}else{speeddial.storage.countBookmarksAndGroups(function(count1,count2){if(count1>3||count2>0){var allowMerge=false;var password=localStorage.getItem("options.sync.password");setValue("options.sync.password","");hide_message(0);$("#sync-conflict-warning").omniWindow({callbacks:{beforeShow:function(s,i){var option;var select=s.modal.find('input[name="sync-preference"]:checked');var confirm=s.modal.find("button[type=submit]");select.removeAttr("checked");confirm.unbind().on("click",function(){option=s.modal.find('input[name="sync-preference"]:checked').val();if(option=="1"){allowMerge=false}else if(option=="2"){allowMerge=true}s.modal.trigger("hide");if(option>0){setValue("options.sync.password",password);s.modal.trigger("hide");show_message(i18n("sync_wait"),true,1e5);b.merge_or_sync(function(){show_message(i18n("sync_complete"),true,600);setTimeout(function(){get_sync_status()},1e3)},allowMerge)}});return i(s)}}}).trigger("show")}else{b.merge_or_sync(function(){show_message(i18n("sync_wait"),true,1e5);setTimeout(function(){show_message(i18n("sync_complete"),true,600);get_sync_status()},1e3)},false)}})}break;case-999:show_message(i18n("sync_enter_credentials"),true,2e3);localStorage.removeItem("options.sync.password");var sync_new_password=$("#options-sync-password").val("");break;case-99:show_message(i18n("sync_wrong_credentials"),true,2e3);localStorage.removeItem("options.sync.password");var sync_new_password=$("#options-sync-password").val("");break;case-1:show_message(i18n("sync_error_not_active"),true,3e3);break;default:hide_message();break}}},"json").error(function(){show_message(i18n("sync_error_timeout"),true,3e3);localStorage.removeItem("options.sync.password")})}else{show_message(i18n("sync_enter_credentials"),true,200);localStorage.removeItem("options.sync.password");var sync_new_password=$("#options-sync-password").val("")}}$("#sync").on("click",function(e){_sync();e.preventDefault()});$("#options-sync-password").keyup(function(e){if(e.keyCode==13){_sync()}});function previewBackground(elem,allowSave){if(!allowSave)return;$(".settings_buttons").hide();$("html").css("background","url("+$(elem).data("url")+"),url("+$(elem).data("pattern")+")").css("background-repeat",$(elem).data("repeat")).css("background-position",$(elem).data("position")).css("background-size",$(elem).data("size")).css("background-color",$(elem).data("color")).css("background-attachment","fixed");$(".themes-confirm").find(".js-confirm-theme").click(function(){setBackground(elem)});$(".themes-confirm").find(".js-dismiss-theme").click(function(){$(".themes-confirm").removeClass("show");$(".settings_buttons").show()});if($(elem).data("customizable")){$(".themes-confirm-customize").show();var el=document.getElementById("color-picker");el.jscolor.fromString($(elem).data("color"));el.jscolor.onFineChange=function(){$(elem).css("background-color",this.toString());$(elem).data("selectedcolor",this.toString());$("html").css("background-color",this.toString())}}else{$(".themes-confirm-customize").hide()}if(allowSave){$(".themes-confirm").addClass("show")}else{$(".themes-confirm").removeClass("show")}}function setBackground(elem){setValue("options.background",$(elem).data("url"));setValue("options.backgroundPattern",$(elem).data("pattern"));setValue("options.backgroundPosition",$(elem).data("position"));setValue("options.repeatbackground",$(elem).data("repeat"));setValue("options.colors.bg",$(elem).data("selectedcolor").replace("#",""));setValue("options.backgroundSize",$(elem).data("size"));$(elem).find("a").text("Background set!");b.sync_settings();top.location.href=chrome.extension.getURL("newtab.html")}for(var i=0;i<themeOptions.length;i++){var freeThemes=15;var bg=themeOptions[i];var wrap=$("<div />");var div=$("<div />").css("background","url("+bg.url+"),url("+bg.pattern+")").css("background-repeat",bg.repeat).css("background-position",bg.position).css("background-size",bg.type=="pattern"?"original":"contain").css("background-color",bg.color).data("url",bg.url).data("pattern",bg.pattern).data("repeat",bg.repeat).data("color",bg.color).data("selectedcolor",bg.color).data("position",bg.position).data("size",bg.size).data("customizable",bg.customizable).appendTo(wrap);wrap.addClass("theme-option").addClass(bg.type).append("<span>"+bg.name+"</span>");if(i>freeThemes-1&&(!getValue("options.sync.username")||!getValue("options.sync.password"))){$(".themes-unlock").show();$(".themes-unlock").append(wrap);div.click(function(){previewBackground(this,false)})}else{$("#themes").append(wrap);div.click(function(){previewBackground(this,true)})}}$(".js-sync-now").click(function(){$this=$(this);$this.text("Synchronizing ...").attr("disabled",true);b.sync(function(){get_sync_status();setTimeout(function(){$this.text("Sync now").attr("disabled",false)},1e3)})})});$(function(){$(".js-reset-settings").click(function(){if(confirm("This will reset all settings and theme to default. Do you wish to proceed?")){if(!app.defaults){return}for(value in app.defaults){setValue(value,app.defaults[value])}b.sync_settings();top.location.reload()}});$(".js-show-advanced-options").click(function(){$(this).parents("tr").remove();$(".advanced-settings").show()});$(".click-preview-shadow").click(function(){setValue("options.dialstyle.shadow",$(this).val());setPreview("shadow",$(this).val())});$(".click-preview-title-alignment").click(function(){var p=$(this).data("option");var v=$(this).data("value");setValue(p,v);setPreview("titlealign",v)});$(".click-set-value").click(function(){var p=$(this).data("option");var v=$(this).data("value");setValue(p,v)});$(".change-toggle-value").change(function(){var p=$(this).data("option");toggleValue(p)});$(".move-settings").click(function(){moveSettings($(this).data("direction"))});$("#show-more-patterns").click(function(){$(".pattern").addClass("featured");$(this).remove()});$(".modal-close").click(function(){$(this).parents(".modal").trigger("hide")});$("#import-settings-button").on("click",function(){$("#import-settings-warning").omniWindow({callbacks:{beforeShow:function(s,i){var confirm=s.modal.find("button[type=submit]");var checkbox=s.modal.find("input[type=checkbox]");confirm.hide();checkbox.removeAttr("checked");checkbox.unbind().on("change",function(){if($(this).is(":checked")){confirm.show()}else{confirm.hide()}});confirm.unbind().bind("click",function(){s.modal.trigger("hide");import_settings()});return i(s)}}}).trigger("show")});$(".save_settings_button").click(function(){b.sync_settings();top.location.href=chrome.extension.getURL("newtab.html")});$("[rel=popover]").popover();$("[rel=tooltip]").tooltip();$(".radio-buttons").buttonset();$("#options-sync-password").hideShowPassword({innerToggle:true,hideToggleUntil:"focus"});$(".click-tab-sync").click(function(){tabsync()});if(location.hash=="#tab-sync"||location.hash=="#sync"){tabsync()}if(location.hash=="#design"){showSection("design")}$(".click-reset-thumbnail-ration").click(function(){resetThumbnailRatio()});$(".click-reset-background").click(function(){$("#options-background").val("");setValue("options.background","")});var paymentProcessor="";$(".become-pro").on("click",function(){$("#become-a-pro-modal").omniWindow().trigger("show")});var showSignupForm=function(paymentMethod){paymentProcessor=paymentMethod;$("#become-a-pro-modal").omniWindow().trigger("hide");$("#create-user-account").omniWindow().trigger("show");$("#create-user-account").find(".error-message").text("");$("#create-user-account").find(".btn").prop("disabled",false);$("#user-account-email").val("");$("#user-account-password").val("")};$("#pay-with-google").on("click",function(){showSignupForm("google")});$("#pay-with-paypal").on("click",function(){showSignupForm("paypal")});var payWithGoogle=function(response){var client=new braintree.api.Client({clientToken:response.token});$("#create-user-account").omniWindow().trigger("hide");$("#pay-with-card").omniWindow().trigger("show");$.fn.toggleInputError=function(erred){this.parent("label").toggleClass("has-error",erred);return this};$("#pay").off().on("click",function(e){$this=$(this);e.preventDefault();$this.prop("disabled",true);var form=$("#payment-form");var cardType=$.payment.cardType($(".cc-number").val());var cardNumber=$(".cc-number").val();var cardExpiry=$(".cc-exp").payment("cardExpiryVal");var cardCvc=$(".cc-cvc").val();$(".cc-number").toggleInputError(!$.payment.validateCardNumber(cardNumber));$(".cc-exp").toggleInputError(!$.payment.validateCardExpiry(cardExpiry));$(".cc-cvc").toggleInputError(!$.payment.validateCardCVC(cardCvc,cardType));if($.payment.validateCardNumber(cardNumber)&&$.payment.validateCardExpiry(cardExpiry)&&$.payment.validateCardCVC(cardCvc,cardType)){client.tokenizeCard({number:$(".cc-number").val(),expirationMonth:cardExpiry.month,expirationYear:cardExpiry.year,cvv:cardCvc},function(err,nonce){if(err){alert("Error while processing payment");$this.prop("disabled",false)}else{b.charge({id:response.id,email:response.email,nonce:nonce},function(data){$this.prop("disabled",false);if(data.success){$("#pay-with-card").omniWindow().trigger("hide");$("#payment-complete").omniWindow().trigger("show");$("#payment-complete").find("button").off().on("click",function(){$("#payment-complete").omniWindow().trigger("hide");email=$("body").data("email");password=$("body").data("password");$("#options-sync-username").val(email);$("#options-sync-password").val(password);$("#sync").click()})}else{error=data.error;form.find(".error-message").text(error)}})}})}else{$this.prop("disabled",false)}})};var payWithPayPal=function(response){var formData=response.paypal;setValue("options.sync.username",response.email);$("#paypal-form").remove();var payPalForm=$("<form />");payPalForm.attr("id","paypal-form");payPalForm.attr("method","post");payPalForm.attr("action",formData["url"]);for(var name in formData){input=$("<input />");input.attr("type","hidden");input.attr("name",name);input.attr("value",formData[name]);input.appendTo(payPalForm)}payPalForm.appendTo("body");payPalForm.submit()};$("#create-user-account form").on("submit",function(e){e.preventDefault();var form=$(this);var email=$(this).find("#user-account-email").val();var password=$(this).find("#user-account-password").val();var error=$(this).find(".error-message");error.text("");if(!email){error.text(i18n("error_enter_email"));return}if(!validateEmail(email)){error.text(i18n("error_invalid_email"));return}if(!password){error.text(i18n("error_enter_password"));return}form.find(".btn").prop("disabled",true);var user={email:email,password:password};var b=chrome.extension.getBackgroundPage();b.get_user_token(user,function(response){if(response.error){error.text(response.error);form.find(".btn").prop("disabled",false);return}else if(response.status=="ok"&&response.token){$("body").data("email",response.email);$("body").data("password",password);if(paymentProcessor=="google"){form.find(".btn").prop("disabled",false);payWithGoogle(response)}else if(paymentProcessor=="paypal"){payWithPayPal(response)}}})});$("#logo-upload").click(function(e){e.preventDefault();if(getValue("options.sync.username")&&getValue("options.sync.password")){upload_file()}});$('a[rel="background_positioning"]').click(function(){switchTab("background_positioning")});$("#background_file .feature-locked a").click(function(){tabsync()});function upload_file(){$("#upload-logo").click();$("#upload-logo").unbind().bind("change",function(){var file=this.files[0];if(file.size>=2500*1024){show_message(i18n("error_file_too_large"),true,800);return}$("#background_file .progress-bar").show();var reader=new FileReader;reader.onload=function(e){var b=chrome.extension.getBackgroundPage();b.upload(this.result,true,function(result){if(result.path!=""){setValue("options.background",result.path);setValue("options.backgroundPattern","");$("#background_file .msg.done").fadeIn(600)}else if(r.error!=""){show_message(i18n("error_file_too_large"),true,800)}$("#background_file .progress-bar").hide()})};reader.readAsDataURL(file)})}});$(function(){$("[data-numeric]").payment("restrictNumeric");$(".cc-number").payment("formatCardNumber");$(".cc-exp").payment("formatCardExpiry");$(".cc-cvc").payment("formatCardCVC");$("input.cc-number").keyup(function(){var cardType=$.payment.cardType($("input.cc-number").val());if(null!==cardType){$(".card-icon").attr("class","card-icon "+cardType)}else{$(".card-icon").attr("class","card-icon")}});$(".modal .close").on("click",function(){$(this).parents(".modal").omniWindow().trigger("hide")})});var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-1391454-40"]);_gaq.push(["_trackPageview"]);(function(){var ga=document.createElement("script");ga.type="text/javascript";ga.async=true;ga.src="https://ssl.google-analytics.com/ga.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga,s)})();speeddial.storage.analytics("options");