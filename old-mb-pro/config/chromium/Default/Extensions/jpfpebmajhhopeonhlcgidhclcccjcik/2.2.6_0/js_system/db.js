$.ajaxSetup({cache:false});var SYNC_URL="https://speeddial2.com";var SORTING=false;var SORTINGGROUPS=false;var COLS=localStorage.getItem("options.columns");var EXPERIMENTAL_THUMBNAIL_CACHE=false;var GROUPS=new Array;var GROUP=0;if(window.location.hash){hash=window.location.hash.replace("#","");if(isNumber(hash)){GROUP=hash;if(localStorage["options.keepActiveGroup"]==1){localStorage["options.activeGroup"]=GROUP}}}if(localStorage["options.keepActiveGroup"]==1&&localStorage["options.activeGroup"]>=0){GROUP=localStorage["options.activeGroup"]}var speeddial={};speeddial.storage={};speeddial.storage.db=null;speeddial.storage.open=function(){var dbSize=1*1024*1024;speeddial.storage.db=null;speeddial.storage.db=openDatabase("bookmarks","1.0","Speeddial2",dbSize)};speeddial.storage.onError=function(tx,e){alert("Something unexpected happened: "+e.message)};speeddial.storage.onSuccess=function(tx,r){speeddial.storage.getAllItemsWithThumbnails(loadItems,GROUP)};speeddial.storage.is_sync=function(){if(localStorage["options.sync.username"]&&localStorage["options.sync.password"])return true;return false};speeddial.storage.batchAddBookmarks=function(items){var deferred=$.Deferred();var length=items.length;console.log("Batch adding bookmarks");function processQueue(i){if(i>=0){value=items[i];if(value.title.indexOf("segment")>-1){console.log(value)}speeddial.storage.addItem(value,function(){processQueue(i-1)})}else{deferred.resolve()}}processQueue(length-1);return deferred.promise()};speeddial.storage.batchEditBookmarks=function(items){var deferred=$.Deferred();var length=items.length;console.log("Batch editing bookmarks");function processQueue(i){if(i>=0){value=items[i];speeddial.storage.editItem(value,false,function(){processQueue(i-1)},false)}else{deferred.resolve()}}processQueue(length-1);return deferred.promise()};speeddial.storage.batchRemoveBookmarks=function(items){var deferred=$.Deferred();var length=items.length;console.log("Batch removing bookmarks");function processQueue(i){if(i>=0){value=items[i];speeddial.storage.deleteItem(value.id,function(){processQueue(i-1)},true)}else{deferred.resolve()}}processQueue(length-1);return deferred.promise()};speeddial.storage.batchAddGroups=function(items){var deferred=$.Deferred();var length=items.length;console.log("Batch adding groups");function processQueue(i){if(i>=0){value=items[i];speeddial.storage.addGroup(value,function(){processQueue(i-1)})}else{deferred.resolve()}}processQueue(length-1);return deferred.promise()};speeddial.storage.batchEditGroups=function(items){var deferred=$.Deferred();var length=items.length;console.log("Batch editing groups");function processQueue(i){if(i>=0){value=items[i];speeddial.storage.editGroup(value,false,function(){processQueue(i-1)})}else{deferred.resolve()}}processQueue(length-1);return deferred.promise()};speeddial.storage.batchRemoveGroups=function(items){var deferred=$.Deferred();var length=items.length;console.log("Batch removing groups");function processQueue(i){if(i>=0){value=items[i];speeddial.storage.deleteGroupItem(value.id,function(){processQueue(i-1)})}else{deferred.resolve()}}processQueue(length-1);return deferred.promise()};speeddial.storage.processSync=function(sync){var deferred=$.Deferred();console.log("New bookmarks",sync.bookmarks.toInsert.length);console.log("Editing bookmarks",sync.bookmarks.toEdit.length);console.log("Removing bookmarks",sync.bookmarks.toRemove.length);console.log("New groups",sync.groups.toInsert.length);console.log("Editing groups",sync.groups.toEdit.length);console.log("Removing groups",sync.groups.toRemove.length);speeddial.storage.batchRemoveBookmarks(sync.bookmarks.toRemove).then(function(){speeddial.storage.batchEditBookmarks(sync.bookmarks.toEdit)}).then(function(){speeddial.storage.batchAddBookmarks(sync.bookmarks.toInsert)}).then(function(){speeddial.storage.batchRemoveGroups(sync.groups.toRemove)}).then(function(){speeddial.storage.batchEditGroups(sync.groups.toEdit)}).then(function(){speeddial.storage.batchAddGroups(sync.groups.toInsert)}).done(function(){deferred.resolve()});return deferred.promise()};speeddial.storage.sync=function(callback){if(!speeddial.storage.is_sync())return false;var current=[],syncBookmarks=[];var currentgroups=[],syncgroups=[];var sync_url=speeddial.storage.sync_url();console.log("Sync started for "+localStorage.getItem("options.sync.username"));$.getJSON(sync_url+"/sync2/get",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password")},function(obj){if(obj){if(obj!=""&&obj.settings&&obj.dials){var sync={bookmarks:{toInsert:[],toEdit:[],toRemove:[]},groups:{toInsert:[],toEdit:[],toRemove:[]}};$.each(obj.dials,function(key,value){syncBookmarks.push(parseInt(value.id))});$.each(obj.groups,function(key,value){syncgroups.push(parseInt(value.id))});speeddial.storage.getAllItems(function(tx,rs){for(var i=0;i<rs.rows.length;i++){current.push(rs.rows.item(i).id)}var to_remove=current.diff(syncBookmarks);var to_insert=syncBookmarks.diff(current);$.each(obj.dials,function(key,value){if($.inArray(parseInt(value.id),to_insert)>-1){sync.bookmarks.toInsert.push(value)}else{sync.bookmarks.toEdit.push(value)}});for(var i=0;i<rs.rows.length;i++){if($.inArray(parseInt(rs.rows.item(i).id),to_remove)>-1){sync.bookmarks.toRemove.push(rs.rows.item(i))}}speeddial.storage.getGroups(function(tx,rs){for(var i=0;i<rs.rows.length;i++){currentgroups.push(rs.rows.item(i).id)}var groups_to_remove=currentgroups.diff(syncgroups);var groups_to_insert=syncgroups.diff(currentgroups);$.each(obj.groups,function(key,value){if($.inArray(parseInt(value.id),groups_to_insert)>-1){sync.groups.toInsert.push(value)}else{sync.groups.toEdit.push(value)}});for(var i=0;i<rs.rows.length;i++){if($.inArray(parseInt(rs.rows.item(i).id),groups_to_remove)>-1){sync.groups.toRemove.push(rs.rows.item(i))}}speeddial.storage.processSync(sync)})});if(obj.settings){$.each(obj.settings,function(key,value){localStorage.setItem(key,value)})}if(obj.status){if(obj.status.last_sync>0){localStorage.setItem("options.sync.lastsync",obj.status.last_sync)}}}if(callback)callback()}})};speeddial.storage.merge_or_sync=function(callback,allowMerge){if(!speeddial.storage.is_sync())return false;var sync_url=speeddial.storage.sync_url();var export_settings={};export_settings.settings={};export_settings.dials={};export_settings.groups={};var merge={};merge.groups={};merge.groups[0]={};merge.groups[0]["title"]="Home";merge.groups[0]["color"]="";merge.groups[0]["position"]=98;merge.groups[0]["bookmarks"]={};speeddial.storage.open();speeddial.storage.getGroups(function(tx,rs){for(var i=0;i<rs.rows.length;i++){export_settings.groups[i]=rs.rows.item(i);var id=rs.rows.item(i).id;merge.groups[id]={};merge.groups[id]["title"]=rs.rows.item(i).title;merge.groups[id]["color"]=rs.rows.item(i).color;merge.groups[id]["position"]=99;merge.groups[id]["bookmarks"]={}}speeddial.storage.getAllItems(function(tx,rs){for(var i=0;i<rs.rows.length;i++){export_settings.dials[i]=rs.rows.item(i);if(typeof merge.groups[rs.rows.item(i).idgroup]!=="undefined"&&null!==merge.groups[rs.rows.item(i).idgroup]){merge.groups[rs.rows.item(i).idgroup]["bookmarks"][i]=rs.rows.item(i)}}for(var i=0;i<window.localStorage.length;i++){key=localStorage.key(i);if(speeddial.storage.filtersync(key)){value=localStorage.getItem(localStorage.key(i));export_settings.settings[key]=value}}$.post(sync_url+"/sync2/backup",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),merge:allowMerge?JSON.stringify(merge,null,2):null,sync:JSON.stringify(export_settings,null,2),"allow-merge":allowMerge},function(response){if(response.code>0){return speeddial.storage.sync(callback)}return false},"json")})},false)};speeddial.storage.import_settings=function(settings,callback){if(!settings)return false;var obj=JSON.parse(settings);if(obj){if(obj.settings){$.each(obj.settings,function(key,value){localStorage.setItem(key,value)})}speeddial.storage.dropTableGroups(function(){speeddial.storage.dropTableBookmarks(function(){speeddial.storage.createTable(function(){if(obj.groups){var number_of_groups=Object.size(obj.groups);function processGroupQueue(i){if(i>=0){item=obj.groups[i];speeddial.storage.addGroup(item,function(){console.log("imported group - "+item.title);processGroupQueue(i-1)})}}processGroupQueue(number_of_groups-1)}if(obj.dials){var number_of_dials=Object.size(obj.dials);function processBookmarkQueue(i){if(i>=0){item=obj.dials[i];if(item.title&&item.url){speeddial.storage.addItem(item,function(){console.log("imported bookmark - "+item.title);processBookmarkQueue(i-1)})}}else{speeddial.storage.optimizeThumbnailCache();setTimeout(function(){b.sync_to_server()},5e3);if(callback)callback()}}processBookmarkQueue(number_of_dials-1)}})})})}};speeddial.storage.sync_to_server=function(callback){if(!speeddial.storage.is_sync())return false;var sync_url=speeddial.storage.sync_url();var export_settings={};export_settings.settings={};export_settings.dials={};export_settings.groups={};speeddial.storage.open();speeddial.storage.getGroups(function(tx,rs){for(var i=0;i<rs.rows.length;i++){export_settings.groups[i]=rs.rows.item(i)}speeddial.storage.getAllItems(function(tx,rs){for(var i=0;i<window.localStorage.length;i++){key=localStorage.key(i);if(speeddial.storage.filtersync(key)){value=localStorage.getItem(localStorage.key(i));export_settings.settings[key]=value}}for(var i=0;i<rs.rows.length;i++){export_settings.dials[i]=rs.rows.item(i)}$.post(sync_url+"/sync2/import",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),sync:JSON.stringify(export_settings,null,2)},function(response){if(response.code==1){if(response.last_sync>0)localStorage.setItem("options.sync.lastsync",response.last_sync)}if(callback)callback(response)},"json")})})};speeddial.storage.backup=function(callback){if(!speeddial.storage.is_sync())return false;console.log("Upstream backup started for "+localStorage.getItem("options.sync.username"));var sync_url=speeddial.storage.sync_url();var export_settings={};export_settings.settings={};export_settings.dials={};export_settings.groups={};speeddial.storage.open();speeddial.storage.getGroups(function(tx,rs){for(var i=0;i<rs.rows.length;i++){export_settings.groups[i]=rs.rows.item(i)}speeddial.storage.getAllItems(function(tx,rs){for(var i=0;i<window.localStorage.length;i++){key=localStorage.key(i);if(speeddial.storage.filtersync(key)){value=localStorage.getItem(localStorage.key(i));export_settings.settings[key]=value}}for(var i=0;i<rs.rows.length;i++){export_settings.dials[i]=rs.rows.item(i)}$.post(sync_url+"/sync2/backup",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),sync:JSON.stringify(export_settings,null,2)},function(response){if(response&&"undefined"!==typeof response.code&&response.code==1){console.log("Backup successfull.")}if(callback)callback(response)},"json")})})};speeddial.storage.sync_url=function(){var u=localStorage.getItem("options.sync.username");var p=localStorage.getItem("options.sync.password");return SYNC_URL};speeddial.storage.get_user_token=function(user,callback){var url=speeddial.storage.sync_url();$.post(url+"/pay/get_user_token",{user:user},function(response){callback(response)},"json")};speeddial.storage.charge=function(data,callback){var url=speeddial.storage.sync_url();$.post(url+"/pay/charge",{id:data.id,email:data.email,nonce:data.nonce},function(response){callback(response)},"json")};speeddial.storage.sign_up=function(user,callback){var url=speeddial.storage.sync_url();$.post(url+"/sync2/sign_up",{user:user},function(response){callback(response)},"json")};speeddial.storage.test_sync_account=function(callback){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();$.post(url+"/sync2/test_account",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password")},function(response){if(response.code=="1"&&parseInt(response.user)>0){callback(response)}else{callback(response)}},"json")};speeddial.storage.get_user_backups=function(callback){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();$.post(url+"/sync2/get_backup",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password")},function(response){if(response.code=="1"&&parseInt(response.user)>0){callback(response)}else{callback(response)}},"json")};speeddial.storage.upload=function(file,large,callback){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();size=large===true?"large":"small";$.post(url+"/sync2/upload",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),quality:localStorage.getItem("options.thumbnailQuality"),size:size,data:file},function(response){callback(response)},"json")};speeddial.storage.sync_settings=function(){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();var settings={};var s={};for(var i=0;i<window.localStorage.length;i++){key=localStorage.key(i);if(speeddial.storage.filtersync(key)){value=localStorage.getItem(localStorage.key(i));settings[key]=value}}s["settings"]=settings;$.post(url+"/sync2/settings",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),s:JSON.stringify(s,null,2)})};speeddial.storage.sync_add_group=function(id,group){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();var s={};s["id"]=id;s["action"]="create";s["group"]={};s["group"]["title"]=group["title"];s["group"]["color"]="";s["group"]["position"]=group["position"];$.post(url+"/sync2/group",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),s:JSON.stringify(s,null,2)})};speeddial.storage.sync_edit_group=function(id,group){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();var s={};s["id"]=id;s["action"]="edit";s["group"]={};s["group"]["title"]=group["title"];s["group"]["color"]="";s["group"]["position"]=group["position"];$.post(url+"/sync2/group",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),s:JSON.stringify(s,null,2)})};speeddial.storage.sync_remove_group=function(id){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();var s={};s["id"]=id;s["action"]="remove";$.post(url+"/sync2/group",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),s:JSON.stringify(s,null,2)})};speeddial.storage.sync_order_groups=function(groups){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();var s={};s["groups"]=groups;s["action"]="reorder";$.post(url+"/sync2/group",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),s:JSON.stringify(s,null,2)})};speeddial.storage.sync_add_bookmark=function(id,bookmark){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();var s={};s["id"]=id;s["action"]="create";s["bookmark"]={};s["bookmark"]["title"]=bookmark["title"];s["bookmark"]["url"]=bookmark["url"];s["bookmark"]["position"]=bookmark["position"];s["bookmark"]["idgroup"]=bookmark["idgroup"];s["bookmark"]["thumbnail"]=bookmark["thumbnail"];s["bookmark"]["ts_created"]=bookmark["ts_created"];$.post(url+"/sync2/bookmark",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),s:JSON.stringify(s,null,2)})};speeddial.storage.sync_edit_bookmark=function(id,bookmark){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();var s={};s["id"]=id;s["action"]="edit";s["bookmark"]={};s["bookmark"]["title"]=bookmark["title"];s["bookmark"]["url"]=bookmark["url"];s["bookmark"]["position"]=bookmark["position"];s["bookmark"]["idgroup"]=bookmark["idgroup"];s["bookmark"]["thumbnail"]=bookmark["thumbnail"];s["bookmark"]["ts_created"]=bookmark["ts_created"];s["bookmark"]["visits"]=bookmark["visits"];s["bookmark"]["visits_morning"]=bookmark["visits_morning"];s["bookmark"]["visits_afternoon"]=bookmark["visits_afternoon"];s["bookmark"]["visits_evening"]=bookmark["visits_evening"];s["bookmark"]["visits_night"]=bookmark["visits_night"];$.post(url+"/sync2/bookmark",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),s:JSON.stringify(s,null,2)})};speeddial.storage.sync_remove_bookmark=function(id){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();var s={};s["id"]=id;s["action"]="remove";$.post(url+"/sync2/bookmark",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),s:JSON.stringify(s,null,2)})};speeddial.storage.sync_order_bookmarks=function(bookmarks){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();var s={};s["bookmarks"]=bookmarks;s["action"]="reorder";$.post(url+"/sync2/bookmark",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),s:JSON.stringify(s,null,2)})};speeddial.storage.filtersync=function(key){noSyncOptions=["options.sync.password","options.sync.username","options.activeGroup","_opened_tabs","_restore_tabs","_closed_tabs","usage.interval","usage.uuid","usage.last","options.activeGroup","events","push.read","push.last","options.prereleases"];if($.inArray(key,noSyncOptions)>-1){return false}if(key.indexOf("thumbnail_")>-1){return false}if(key.indexOf("temporary.")>-1){return false}return true};speeddial.storage.sync_move_bookmark=function(id_bookmark,id_group){if(!speeddial.storage.is_sync())return false;var url=speeddial.storage.sync_url();var s={};s["bookmark"]=id_bookmark;s["group"]=id_group;s["action"]="move";$.post(url+"/sync2/bookmark",{username:localStorage.getItem("options.sync.username"),password:localStorage.getItem("options.sync.password"),s:JSON.stringify(s,null,2)})};speeddial.storage.uuid=function(){var S4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};localStorage["usage.uuid"]||(localStorage["usage.uuid"]=S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());localStorage["usage.interval"]||(localStorage["usage.interval"]=Math.floor(Math.random()*3600*24*14+3600*24*14));if(!localStorage["usage.last"]){localStorage["usage.last"]=Math.round(+new Date/1e3)}};speeddial.storage.analytics=function(evt){var events=localStorage["events"];if(events){eventsObj=JSON.parse(events);if(eventsObj[evt]){eventsObj[evt]+=1}else{eventsObj[evt]=1}}else{eventsObj={};eventsObj[evt]=1}localStorage["events"]=JSON.stringify(eventsObj,null,2)};speeddial.storage.sync_usage=function(){return;var s={};var sync_url=speeddial.storage.sync_url();s["last"]=localStorage.getItem("usage.last");localStorage["usage.last"]=Math.round(+new Date/1e3);speeddial.storage.db.transaction(function(tx){query="SELECT * FROM bookmarks ORDER BY position ASC";tx.executeSql(query,[],function(tx,rs){s["c"]=rs.rows.length;s["d"]=[];s["o"]={};s["e"]=localStorage["events"]?JSON.parse(localStorage["events"]):null;s["uuid"]=localStorage.getItem("usage.uuid");if(localStorage.getItem("options.sync.password")&&localStorage.getItem("options.sync.username")){s["p"]=1}else{s["p"]=0}if(localStorage.getItem("sys.groups")){s["g"]=localStorage.getItem("sys.groups")}else{s["g"]=0}for(var i=0;i<rs.rows.length;i++){var url=rs.rows.item(i).url;if(typeof url!="undefined"&&url.indexOf("chrome-extension")<0&&url.indexOf("http")>-1){if($.inArray(url.split(/\/+/g)[1],s["d"])==-1){s["d"].push(url.split(/\/+/g)[1])}}}var items=["options.alwaysNewTab","options.apps.show","options.apps.theme","options.centerVertically","options.columns","options.dialSpace","options.dialspacing","options.dialstyle.corners","options.dialstyle.titleAlign","options.highlight","options.order","options.padding","options.refreshThumbnails","options.scrollLayout","options.showAddButton","options.showContextMenu","options.showTitle","options.showVisits","options.sidebar","options.sidebar.showApps","options.sidebar.showBookmarks","options.sidebar.showHistory","options.thumbnailQuality","options.titleAlign"];for(var i=0;i<items.length;i++){s["o"][items[i]]=localStorage[items[i]]}$.post(sync_url+"/sync2/usage",{sync:JSON.stringify(s,null,2)},function(response){if(response.code==1){localStorage["events"]=[]}},"json")},speeddial.storage.onError)})};speeddial.storage.createTable=function(callback){speeddial.storage.db.transaction(function(tx){tx.executeSql("CREATE TABLE IF NOT EXISTS "+"bookmarks(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, title TEXT, url TEXT, thumbnail TEXT NULL, ts_created INTEGER, visits INTEGER, visits_morning INTEGER, visits_afternoon INTEGER, visits_evening INTEGER, visits_night INTEGER, position INTEGER, idgroup INTEGER DEFAULT 0)",[],null,speeddial.storage.onError)});speeddial.storage.db.transaction(function(tx){tx.executeSql("CREATE TABLE IF NOT EXISTS "+"groups(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, title TEXT, color TEXT, position INTEGER DEFAULT 0)",[],null,speeddial.storage.onError)});speeddial.storage.db.transaction(function(tx){tx.executeSql("CREATE TABLE IF NOT EXISTS "+"thumbnails(url TEXT NOT NULL, thumbnail TEXT)",[],callback,speeddial.storage.onError)})};speeddial.storage.dropTableBookmarks=function(callback){speeddial.storage.db.transaction(function(tx){tx.executeSql("DROP TABLE bookmarks",[],callback,speeddial.storage.onError)})};speeddial.storage.getAllItems=function(renderFunc,id_group){if(parseInt(id_group)>-1){speeddial.storage.db.transaction(function(tx){tx.executeSql("SELECT * FROM groups WHERE id = ?",[id_group],function(ts,rs){var query="SELECT * FROM bookmarks WHERE idgroup = ? ORDER BY visits DESC";if(localStorage.getItem("options.order")=="position"){query="SELECT * FROM bookmarks WHERE idgroup = ? ORDER BY position ASC, ts_created ASC"}if(rs.rows.length>0){speeddial.storage.db.transaction(function(tx){tx.executeSql(query,[id_group],renderFunc,speeddial.storage.onError)})}else{speeddial.storage.db.transaction(function(tx){tx.executeSql(query,[0],renderFunc,speeddial.storage.onError)})}},speeddial.storage.onError)})}else{speeddial.storage.db.transaction(function(tx){query="SELECT * FROM bookmarks ORDER BY position ASC";tx.executeSql(query,[],renderFunc,speeddial.storage.onError)})}};speeddial.storage.getAllItemsWithThumbnails=function(renderFunc,id_group){if(parseInt(id_group)>-1){speeddial.storage.db.transaction(function(tx){tx.executeSql("SELECT * FROM groups WHERE id = ?",[id_group],function(ts,rs){var query="SELECT thumbnails.thumbnail as dataThumbnail, bookmarks.* FROM bookmarks LEFT JOIN thumbnails ON thumbnails.url = bookmarks.url WHERE bookmarks.idgroup = ? ORDER BY bookmarks.visits DESC";if(localStorage.getItem("options.order")=="position"){query="SELECT thumbnails.thumbnail as dataThumbnail, bookmarks.* FROM bookmarks LEFT JOIN thumbnails ON thumbnails.url = bookmarks.url WHERE bookmarks.idgroup = ? ORDER BY bookmarks.position ASC, bookmarks.ts_created ASC"}if(rs.rows.length>0){speeddial.storage.db.transaction(function(tx){tx.executeSql(query,[id_group],renderFunc,speeddial.storage.onError)})}else{speeddial.storage.db.transaction(function(tx){tx.executeSql(query,[0],renderFunc,speeddial.storage.onError)})}},speeddial.storage.onError)})}else{speeddial.storage.db.transaction(function(tx){query="SELECT * FROM bookmarks ORDER BY position ASC";tx.executeSql(query,[],renderFunc,speeddial.storage.onError)})}};speeddial.storage.countBookmarksAndGroups=function(callback){var _c,_d;speeddial.storage.db.transaction(function(tx){tx.executeSql("SELECT COUNT(*) as count FROM bookmarks",[],function(ts,rs){_c=rs.rows.item(0).count;speeddial.storage.db.transaction(function(tx){tx.executeSql("SELECT COUNT(*) as count FROM groups",[],function(ts,rs){_d=rs.rows.item(0).count;return callback(_c,_d)})})})})};speeddial.storage.getItem=function(id,renderFunc){speeddial.storage.db.transaction(function(tx){tx.executeSql("SELECT * FROM bookmarks WHERE id = ?",[id],renderFunc,speeddial.storage.onError)})};speeddial.storage.addItem=function(bookmark,callback){if(!callback){callback=speeddial.storage.onSuccess}if(!bookmark["thumbnail"])bookmark["thumbnail"]="";if(!bookmark["ts_created"])bookmark["ts_created"]=Math.round((new Date).getTime()/1e3);if(!bookmark["position"])bookmark["position"]=999;if(!bookmark["visits"])bookmark["visits"]=0;if(!bookmark["visits_afternoon"])bookmark["visits_afternoon"]=0;if(!bookmark["visits_evening"])bookmark["visits_evening"]=0;if(!bookmark["visits_morning"])bookmark["visits_morning"]=0;if(!bookmark["visits_night"])bookmark["visits_night"]=0;if(typeof bookmark["idgroup"]=="undefined")bookmark["idgroup"]=0;if(bookmark["id"]>0){speeddial.storage.db.transaction(function(tx){tx.executeSql("INSERT INTO bookmarks (id, title, url, thumbnail, ts_created, visits, visits_morning, visits_afternoon, visits_evening, visits_night, position, idgroup) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[bookmark["id"],bookmark["title"],bookmark["url"],bookmark["thumbnail"],bookmark["ts_created"],bookmark["visits"],bookmark["visits_morning"],bookmark["visits_afternoon"],bookmark["visits_evening"],bookmark["visits_night"],bookmark["position"],bookmark["idgroup"]],callback,speeddial.storage.onError)})}else{if(typeof Uri!=="undefined"&&(bookmark["url"].includes("/dp/")||bookmark["url"].includes("/gp/"))&&bookmark["url"].includes("amazon.")){if(!bookmark["url"].includes("tag=")){var uri=new Uri(bookmark["url"]);if(bookmark["url"].includes("amazon.com/")){uri.addQueryParam("tag","precious0d803-20");bookmark["url"]=uri.toString()}else if(bookmark["url"].includes("amazon.co.uk/")){uri.addQueryParam("tag","precious0uk-21");bookmark["url"]=uri.toString()}else if(bookmark["url"].includes("amazon.de/")){uri.addQueryParam("tag","precious0de-21");bookmark["url"]=uri.toString()}else if(bookmark["url"].includes("amazon.fr/")){uri.addQueryParam("tag","precious0fr-21");bookmark["url"]=uri.toString()}else if(bookmark["url"].includes("amazon.it/")){uri.addQueryParam("tag","precious0it-21");bookmark["url"]=uri.toString()}else if(bookmark["url"].includes("amazon.es/")){uri.addQueryParam("tag","precious0es-21");bookmark["url"]=uri.toString()}}}speeddial.storage.db.transaction(function(tx){tx.executeSql("INSERT INTO bookmarks (title, url, thumbnail, ts_created, visits, visits_morning, visits_afternoon, visits_evening, visits_night, position, idgroup) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[bookmark["title"],bookmark["url"],bookmark["thumbnail"],bookmark["ts_created"],bookmark["visits"],bookmark["visits_morning"],bookmark["visits_afternoon"],bookmark["visits_evening"],bookmark["visits_night"],bookmark["position"],bookmark["idgroup"]],function(tx,rs){var id=rs.insertId;b.sync_add_bookmark(id,bookmark);callback()},speeddial.storage.onError)})}};speeddial.storage.editItem=function(bookmark,clearVisitsData,callback,sync){if(!callback){callback=speeddial.storage.onSuccess}if(!bookmark)return false;if(clearVisitsData==true){clearData=",visits=0"}else{clearData=""}if(parseInt(bookmark["position"])>0){speeddial.storage.db.transaction(function(tx){tx.executeSql("UPDATE bookmarks SET title=?, url=?, thumbnail =?, position=?, idgroup =? "+clearData+" WHERE id=?",[bookmark["title"],bookmark["url"],bookmark["thumbnail"],parseInt(bookmark["position"]),bookmark["idgroup"],bookmark["id"]],function(tx,rs){if(sync!==false)b.sync_edit_bookmark(bookmark["id"],bookmark);callback(tx,rs)},speeddial.storage.onError)})}else{speeddial.storage.db.transaction(function(tx){tx.executeSql("UPDATE bookmarks SET title=?, url=?, thumbnail =?, idgroup =? "+clearData+" WHERE id=?",[bookmark["title"],bookmark["url"],bookmark["thumbnail"],bookmark["idgroup"],bookmark["id"]],function(tx,rs){if(sync!==false)b.sync_edit_bookmark(bookmark["id"],bookmark);callback(tx,rs)},speeddial.storage.onError)})}};speeddial.storage.deleteItem=function(id,callback,skipSynchronization){speeddial.storage.db.transaction(function(tx){tx.executeSql("DELETE FROM bookmarks WHERE ID=?",[id],function(){if(skipSynchronization!=true){b.sync_remove_bookmark(id)}if(callback){callback()}},speeddial.storage.onError)})};speeddial.storage.updateItemOrder=function(id,position){speeddial.storage.db.transaction(function(tx){tx.executeSql("UPDATE bookmarks SET position=? WHERE ID=?",[position,id],null,speeddial.storage.onError)})};speeddial.storage.dropTableGroups=function(callback){speeddial.storage.db.transaction(function(tx){tx.executeSql("DROP TABLE groups",[],callback,speeddial.storage.onError)})};speeddial.storage.getGroups=function(callback){speeddial.storage.db.transaction(function(tx){GROUPS=[];GROUPS.length=0;var query="SELECT * FROM groups ORDER BY position ASC, title ASC";tx.executeSql(query,[],callback,speeddial.storage.onError)})};speeddial.storage.getGroup=function(id,renderFunc){speeddial.storage.db.transaction(function(tx){tx.executeSql("SELECT * FROM groups WHERE id = ?",[id],renderFunc,speeddial.storage.onError)})};speeddial.storage.addGroup=function(group,callback){if(!callback){callback=speeddial.storage.onSuccess}if(group["id"]){speeddial.storage.db.transaction(function(tx){tx.executeSql("INSERT INTO groups (id, title, color, position) values (?, ?, ?, ?)",[group["id"],group["title"],"",group["position"]],callback,speeddial.storage.onError)})}else{speeddial.storage.db.transaction(function(tx){tx.executeSql("INSERT INTO groups (title, color, position) values (?, ?, ?)",[group["title"],"",99],function(tx,rs){var id=rs.insertId;b.sync_add_group(id,group);callback(tx,rs)},speeddial.storage.onError)})}};speeddial.storage.editGroup=function(group,sync,callback){if(!group)return false;if(!callback)callback=reload;if(group["position"]>0){speeddial.storage.db.transaction(function(tx){tx.executeSql("UPDATE groups SET title=?, color =?, position =? WHERE id=?",[group["title"],"",group["position"],group["id"]],function(tx,rs){if(sync==true){b.sync_edit_group(group["id"],group)}callback(tx,rs)},speeddial.storage.onError)})}else{speeddial.storage.db.transaction(function(tx){tx.executeSql("UPDATE groups SET title=?, color =? WHERE id=?",[group["title"],"",group["id"]],function(tx,rs){if(sync==true){b.sync_edit_group(group["id"],group)}callback(tx,rs)},speeddial.storage.onError)})}};speeddial.storage.setGroupPosition=function(group,position){if(!group||!position)return false;speeddial.storage.db.transaction(function(tx){tx.executeSql("UPDATE groups SET position=? WHERE id=?",[position,group],null,speeddial.storage.onError)})};speeddial.storage.moveToGroup=function(idDial,idGroup,callback){if(parseInt(idDial)>0&&parseInt(idGroup)>=0){speeddial.storage.db.transaction(function(tx){tx.executeSql("UPDATE bookmarks SET idgroup=?,position=? WHERE id =?",[idGroup,999,idDial],function(tx,rs){b.sync_move_bookmark(idDial,idGroup);callback(tx,rs)},speeddial.storage.onError)})}};speeddial.storage.deleteGroup=function(id,skipreload,skipSynchronization){if(parseInt(id)>0){speeddial.storage.db.transaction(function(tx){tx.executeSql("DELETE FROM groups WHERE ID=?",[id],function(){query="SELECT * FROM bookmarks WHERE idgroup = ? ORDER BY position ASC";tx.executeSql(query,[id],function(tx,rs){for(var i=0;i<rs.rows.length;i++){speeddial.storage.deleteItem(rs.rows.item(i).id,null,true);speeddial.storage.removeThumbnail(rs.rows.item(i).url)}if(skipreload!==true){reload()}},speeddial.storage.onError)},speeddial.storage.onError)});if(skipSynchronization!=true){b.sync_remove_group(id)}}};speeddial.storage.deleteGroupItem=function(id,callback){if(!parseInt(id))return;speeddial.storage.db.transaction(function(tx){tx.executeSql("DELETE FROM groups WHERE ID=?",[id],function(){speeddial.storage.db.transaction(function(tx){tx.executeSql("DELETE FROM bookmarks WHERE idgroup =?",[id],function(){if(callback)callback()},null)})},speeddial.storage.onError)})};speeddial.storage.insertThumbnail=function(url,thumbnail,callback){console.log("Inserting thumbnail - "+url);speeddial.storage.db.transaction(function(tx){tx.executeSql("DELETE FROM thumbnails WHERE url = ?",[url],function(){tx.executeSql("INSERT INTO thumbnails (url, thumbnail) values (?, ?)",[url,thumbnail],function(){speeddial.storage.removeCacheThumbnail(url)},speeddial.storage.onError)},speeddial.storage.onError)})};speeddial.storage.removeThumbnail=function(url){if(!url)return;speeddial.storage.db.transaction(function(tx){tx.executeSql("DELETE FROM thumbnails WHERE url = ?",[url],null,speeddial.storage.onError)})};speeddial.storage.getThumbnail=function(url,element,parent){if(EXPERIMENTAL_THUMBNAIL_CACHE===true&&localStorage["thumbnail_"+encodeURIComponent(url)]){element.style.backgroundImage="url("+localStorage["thumbnail_"+encodeURIComponent(url)]+")";parent.setAttribute("class","link");return}speeddial.storage.db.transaction(function(tx){tx.executeSql("SELECT * FROM thumbnails WHERE url = ? LIMIT 1",[url],function(tx,rs){if(rs.rows.length>0){element.style.backgroundImage="url("+rs.rows.item(0).thumbnail+")";if(EXPERIMENTAL_THUMBNAIL_CACHE===true&&GROUP==0){localStorage["thumbnail_"+encodeURIComponent(url)]=rs.rows.item(0).thumbnail}parent.setAttribute("class","link")}else{parent.setAttribute("class","link no-thumbnail")}},speeddial.storage.onError)})};speeddial.storage.ThumbnailRemoveIfDoesntExists=function(url){speeddial.storage.db.transaction(function(tx){tx.executeSql("SELECT * FROM bookmarks WHERE url = ?",[url],function(tx,rs){if(rs.rows.length<=0){tx.executeSql("DELETE FROM thumbnails WHERE url = ?",[url],null,speeddial.storage.onError);console.log("Removed url - "+url)}},speeddial.storage.onError)})};speeddial.storage.optimizeThumbnailCache=function(){speeddial.storage.db.transaction(function(tx){tx.executeSql("SELECT * FROM thumbnails",[],function(tx,rs){console.log("optimizeThumbnailCache - Selected all bookmarks");for(var i=0;i<rs.rows.length;i++){console.log("optimizeThumbnailCache - check "+rs.rows.item(i).url);speeddial.storage.ThumbnailRemoveIfDoesntExists(rs.rows.item(i).url)}},speeddial.storage.onError)})};speeddial.storage.removeCacheThumbnail=function(url){return true};speeddial.storage.alterTable=function(query){speeddial.storage.db.transaction(function(tx){tx.executeSql(query,[],null,speeddial.storage.onError)})};speeddial.storage.hightlightExperimental=function(){if(localStorage["options.highlight"]==1){var dayPart="";var hours=(new Date).getHours();if(hours>=0)dayPart="night";if(hours>=6)dayPart="morning";if(hours>=12)dayPart="afternoon";if(hours>=18)dayPart="evening";var query="SELECT id FROM bookmarks WHERE idgroup="+GROUP+" ORDER BY visits_"+dayPart+" DESC LIMIT 3";speeddial.storage.db.transaction(function(tx){tx.executeSql(query,[],function(tx,rs){for(var i=0;i<rs.rows.length;i++){$("#pages li#"+rs.rows.item(i).id).find(".thumbnail_container").prepend('<img src="images/newtab.highlighted.png" class="highlight_corner" />')}PADDING=parseInt(localStorage["options.padding"]);$(".highlight_corner").css({top:-PADDING,right:-PADDING})},null,speeddial.storage.onError)})}};speeddial.storage.trackVisits=function(url){var dayPart="";var hours=(new Date).getHours();if(hours>=0)dayPart="night";if(hours>=6)dayPart="morning";if(hours>=12)dayPart="afternoon";if(hours>=18)dayPart="evening";speeddial.storage.db.transaction(function(tx){tx.executeSql("UPDATE bookmarks SET visits=visits+1, visits_"+dayPart+"=visits_"+dayPart+"+1 WHERE url=?",[url],null,speeddial.storage.onError)})};speeddial.storage.simpleSearch=function(searchTerm){var query="SELECT thumbnails.thumbnail as dataThumbnail, bookmarks.* FROM bookmarks LEFT JOIN thumbnails ON thumbnails.url = bookmarks.url WHERE bookmarks.title LIKE ? OR bookmarks.url LIKE ? ORDER BY visits DESC LIMIT 64";speeddial.storage.db.transaction(function(tx){tx.executeSql(query,["%"+searchTerm+"%","%"+searchTerm+"%"],function(tx,rs){loadItems(tx,rs)},speeddial.storage.onError)})};speeddial.storage.showGroups=function(tx,rs){for(var i=0;i<rs.rows.length;i++){GROUPS.push(rs.rows.item(i))}if(GROUP>0&&GROUPS.length==0){GROUP=0;reload()}GROUPS_COUNT=GROUPS.length;var grouplist=document.getElementById("groups");if(grouplist){grouplist.innerHTML=""}if(GROUPS.length==0)return false;var li=document.createElement("li");var link=document.createElement("a");link.setAttribute("class",GROUP==0?"group selected":"group");link.setAttribute("href","#0");link.innerHTML=localStorage["options.defaultGroupName"];li.setAttribute("class","home");li.setAttribute("loadgroup",0);li.appendChild(link);grouplist.appendChild(li);for(var i=0;i<GROUPS.length;i++){var li=document.createElement("li");var link=document.createElement("a");link.setAttribute("class",GROUPS[i].id==GROUP?"group selected":"group");link.setAttribute("href","#"+GROUPS[i].id);link.innerHTML=GROUPS[i].title;li.setAttribute("loadgroup",GROUPS[i].id);li.appendChild(link);grouplist.appendChild(li)}};function loadItems(tx,rs){COLS=localStorage.getItem("options.columns");BOOKMARKS_COUNT=rs.rows.length;var row,position;var container=document.getElementById("pages");container.innerHTML="";var groupscontainer=document.getElementById("groups");var browser_toolbar=130;var groups_space=90;if(GROUPS.length>0){groups_space=30+parseInt($("#groups").css("height"))}else{groups_space=15}var apps_space=102;var TITLE=24;ROWS=Math.ceil(rs.rows.length/COLS);SPACING=parseInt(localStorage["options.dialspacing"]);NUMBER_OF_GROUPS=GROUPS.length;PADDING=parseInt(localStorage["options.padding"]);WIDTHMODIFIER=parseInt(getValue("options.dialSpace"))>0?getValue("options.dialSpace")/100:.9;WINDOW_WIDTH=window.screen.width;WINDOW_HEIGHT=window.screen.height;WINDOW_INNER_WIDTH=window.innerWidth;SPACE=window.innerHeight-40;RATIO=(WINDOW_HEIGHT-browser_toolbar)/WINDOW_WIDTH;RATIO_MODIFIED=false;CUSTOM_RATIO=parseFloat(localStorage["options.thumbnailRatio"])>0&&localStorage["options.thumbnailRatio"]!=1?true:false;var CONTAINER_TOP=15;if(NUMBER_OF_GROUPS==0){$("body").addClass("is-without-groups")}else{$("body").addClass("is-with-groups")}if(localStorage.getItem("options.showSearch")==1){$("body").addClass("is-with-search")}if(RATIO<.55){RATIO=.55;RATIO_MODIFIED=true}if(RATIO>.65){RATIO=.65}if(CUSTOM_RATIO){RATIO=RATIO*localStorage["options.thumbnailRatio"]}if(localStorage["options.apps.show"]=="1"){SPACE-=apps_space}if(localStorage["options.scrollLayout"]==1){$("#container").addClass("scroll")}else{$("#container").removeClass("scroll")}if(NUMBER_OF_GROUPS>0){SPACE-=groups_space}var DIALSPACE=WIDTHMODIFIER*WINDOW_INNER_WIDTH;var DIALWIDTH=(DIALSPACE-COLS*SPACING)/COLS;DIALWIDTH=Math.floor(DIALWIDTH);if(DIALWIDTH>360)DIALWIDTH=360;var DIALHEIGHT=DIALWIDTH*RATIO;if(localStorage["options.showTitle"]!=1){TITLE=PADDING+2}var RESIZEDDIALS=false;if(localStorage["options.scrollLayout"]!="1"&&ROWS*(DIALHEIGHT+SPACING+PADDING+TITLE)>SPACE){RESIZEDDIALS=true;DIALHEIGHT=(SPACE-ROWS*(SPACING+PADDING+TITLE))/ROWS;DIALWIDTH=Math.floor(DIALHEIGHT/RATIO)}if(localStorage["options.centerVertically"]=="1"&&RESIZEDDIALS==false){if(NUMBER_OF_GROUPS==0){CONTAINER_TOP-=15}else{}}container.style.width=COLS*(DIALWIDTH+SPACING)+"px";var THUMBNAILHEIGHT=(DIALWIDTH-2*PADDING)*RATIO+PADDING;var is_sync=speeddial.storage.is_sync();var shadow=localStorage["options.dialstyle.shadow"];for(var i=0;i<rs.rows.length;i++){row=rs.rows.item(i);var li=document.createElement("li");var link=document.createElement("a");var thumbnail_container=document.createElement("div");var dialtitle=document.createElement("div");li.setAttribute("class","link");li.setAttribute("id",row["id"]);li.setAttribute("url",row["url"]);li.setAttribute("position",row["position"]);li.setAttribute("visits",row["visits"]);link.setAttribute("href",row["url"]);link.style.width=DIALWIDTH+"px";dialtitle.style.marginLeft=SPACING/2+"px";dialtitle.style.display="block";dialtitle.style.margin="0 auto";dialtitle.setAttribute("class","title");dialtitle.innerHTML=safestr(row["title"]);if(!row["thumbnail"]&&row["dataThumbnail"]){thumbnail_container.style.backgroundImage="url("+row["dataThumbnail"]+")";if(RATIO_MODIFIED==true){thumbnail_container.style.backgroundSize="102% 100%"}else{thumbnail_container.style.backgroundSize="102%"}if(CUSTOM_RATIO){thumbnail_container.style.backgroundSize="cover";thumbnail_container.style.backgroundPosition="top center"}}else if(row["thumbnail"]!=""){li.setAttribute("custom_thumbnail","true");if(localStorage["options.centerThumbnailsVertically"]=="2"){thumbnail_container.style.backgroundSize="100%";thumbnail_container.style.backgroundPosition="center center"}else if(localStorage["options.centerThumbnailsVertically"]=="1"){thumbnail_container.style.backgroundSize="contain";thumbnail_container.style.backgroundPosition="center center"}else if(localStorage["options.centerThumbnailsVertically"]=="0"){thumbnail_container.style.backgroundSize="100%";thumbnail_container.style.backgroundPosition="top center"}else{thumbnail_container.style.backgroundSize="auto";thumbnail_container.style.backgroundPosition="top center"}if(row["thumbnail"].indexOf(" ")>-1){thumbnail_container.style.backgroundImage="url("+encodeURI(row["thumbnail"])+")"}else{thumbnail_container.style.backgroundImage="url("+row["thumbnail"]+")"}}else{if(is_sync&&row["ts_created"]>1398902400){li.classList.add("no-thumbnail-yet");thumbnail_container.style.backgroundSize="100%";thumbnail_container.style.backgroundPosition="center center";thumbnail_container.style.backgroundImage="url(http://static.speeddial2.com/screenshot/?url="+encodeURI(row["url"])+")"}else{li.classList.add("no-thumbnail-yet");thumbnail_container.style.backgroundSize="100%";thumbnail_container.style.backgroundPosition="center center";thumbnail_container.style.backgroundImage="url(http://static.speeddial2.com/screenshot/?type=existing&url="+encodeURI(row["url"])+")"}}if(typeof shadow!="undefined"&&shadow!="none"){li.classList.add("link--shadow");li.classList.add("link--shadow-"+shadow)}thumbnail_container.setAttribute("class","thumbnail_container");thumbnail_container.style.height=THUMBNAILHEIGHT;link.appendChild(thumbnail_container);link.style.height=THUMBNAILHEIGHT+PADDING+TITLE;link.style.padding=PADDING+"px";link.style.margin=SPACING/2;li.style.height=THUMBNAILHEIGHT+PADDING+TITLE+SPACING;li.style.overflow="hidden";link.appendChild(thumbnail_container);if(localStorage["options.showTitle"]==1){link.appendChild(dialtitle)}link.style.paddingBottom=0;thumbnail_container.style.height=THUMBNAILHEIGHT;if(localStorage["options.showVisits"]==1){var visits=document.createElement("span");visits.setAttribute("class","visits");visits.innerHTML=row["visits"];dialtitle.appendChild(visits)}li.appendChild(link);container.appendChild(li)}if(localStorage["options.centerVertically"]=="1"&&RESIZEDDIALS==false){var rowsheight=ROWS*(THUMBNAILHEIGHT+2*PADDING+SPACING);var top=(SPACE-rowsheight)/2;if(top>=0){container.style.paddingTop=CONTAINER_TOP-groups_space/2+(SPACE-rowsheight)/2}else{container.style.paddingTop=15}}else{if(NUMBER_OF_GROUPS==0&&RESIZEDDIALS==false){container.style.paddingTop=2*CONTAINER_TOP}else{container.style.paddingTop=CONTAINER_TOP}}if(getValue("options.showAddButton")==1){position=rs.rows.length+1;emptyrow=document.createElement("li");emptyrow.setAttribute("id","emptyrow");emptyrow.innerHTML='<img src="images/newtab.first-dial-small.svg" width="64" />';emptyrow.style.width=SPACING+DIALWIDTH+"px";emptyrow.style.height=SPACING+PADDING+DIALHEIGHT+"px";emptyrow.addEventListener("click",function(){controller.addBookmarkDialog()});container.appendChild(emptyrow)}if(rs.rows.length==0){if(getValue("options.showAddButton")==1){if(emptyrow)emptyrow.style.display="none"}if(!document.getElementsByClassName("first-dial").length){firstdial=document.createElement("div");firstdial.setAttribute("src","images/newtab.first-dial.png");firstdial.setAttribute("class","first-dial emptyrow");firstdial.innerHTML=i18n("click_here_to_start");firstdial.addEventListener("click",function(){controller.addBookmarkDialog()});document.body.appendChild(firstdial)}}else if($(".first-dial")){$(".first-dial").remove()}if(localStorage["options.apps.show"]=="1"){container.style.marginBottom=100}localStorage.setItem("sys.groups",NUMBER_OF_GROUPS);pagesOnLoad();speeddial.storage.hightlightExperimental()}function init(){speeddial.storage.open();speeddial.storage.createTable();speeddial.storage.uuid();speeddial.storage.getGroups(speeddial.storage.showGroups);speeddial.storage.getAllItemsWithThumbnails(loadItems,GROUP)}function reload(){speeddial.storage.getGroups(speeddial.storage.showGroups);speeddial.storage.getAllItemsWithThumbnails(loadItems,GROUP)}function background_init(){speeddial.storage.open();speeddial.storage.createTable()}